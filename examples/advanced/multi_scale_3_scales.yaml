# Multi-Scale Feature Computation - Standard Configuration
# IGN LiDAR HD Processing v6.3
#
# This configuration uses 3 scales (fine, medium, coarse) for balanced
# artifact suppression and computational performance.
# Updated v6.3: Now supports adaptive aggregation method
#
# Use case: Production use, general-purpose LiDAR processing
# Expected artifact reduction: 20-40% â†’ 5-10%
# Performance: ~3x single-scale computation

processor:
  lod_level: LOD2
  processing_mode: patches_only
  use_gpu: false
  patch_size: 150.0
  num_points: 16384

preprocess:
  enabled: false
  sor_k: 12
  sor_std: 2.0
  ror_radius: 1.0
  ror_neighbors: 4
  voxel_enabled: false
  voxel_size: 0.1

stitching:
  enabled: false
  buffer_size: 10.0
  auto_detect_neighbors: true
  auto_download_neighbors: false
  cache_enabled: true

features:
  mode: lod2
  k_neighbors: 30
  search_radius: 3.0

  # Enable multi-scale computation
  multi_scale_computation: true

  # Define 3 scales: fine, medium, coarse
  scales:
    - name: fine
      k_neighbors: 20
      search_radius: 1.0
      weight: 0.3 # Lower weight (more artifact-prone)

    - name: medium
      k_neighbors: 50
      search_radius: 2.5
      weight: 0.5 # Highest weight (best balance)

    - name: coarse
      k_neighbors: 100
      search_radius: 5.0
      weight: 0.2 # Lower weight (less detail)

  # Aggregation settings
  # Options: weighted_average | variance_weighted | adaptive (NEW in v6.3)
  aggregation_method: variance_weighted
  variance_penalty_factor: 2.0

  # NOTE: Set to "adaptive" for geometry-aware scale selection (better edges)

  # Artifact detection
  detect_artifacts: true
  artifact_variance_threshold: 0.15
  artifact_gradient_threshold: 0.10

  # Output options
  save_per_scale_features: false
  save_artifact_mask: true

  # Performance settings
  parallel_scale_computation: false
  cache_kdtrees: true

  # RGB/NIR augmentation
  use_rgb: true
  use_nir: true
  rgb_cache_dir: null # Will use temp directory

data_sources:
  bd_topo:
    buildings: true
    roads: true
    vegetation: true
    water: true

output:
  enriched_laz: true
  patches: true
  classification_stats: true
