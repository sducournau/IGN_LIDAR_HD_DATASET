# ============================================================================
# IGN LiDAR HD - Basic GPU Configuration
# ============================================================================
# GPU-accelerated processing with LOD2 features.
# Perfect for: Users with GPU (12GB+ VRAM), medium-large datasets (10-50 tiles)
#
# What this does:
# - LOD2 classification (12 features, 15 building classes)
# - GPU acceleration (10-20x faster than CPU)
# - Multi-scale artifact suppression (2 scales)
# - No external data sources (works offline)
#
# Expected performance: ~30-60 sec per 18M point tile (GPU: RTX 3080+)
# Requirements: NVIDIA GPU with 12GB+ VRAM, CUDA 11.8+
# ============================================================================

# Input/Output paths (REQUIRED - modify these)
input_dir: "/path/to/your/laz/tiles"
output_dir: "/path/to/output"

# ============================================================================
# PROCESSOR SETTINGS
# ============================================================================
processor:
  # Processing level
  lod_level: "LOD2" # Simplified building classification

  # What to generate
  processing_mode: "patches_only" # Only create training patches

  # Hardware (GPU)
  use_gpu: true # Enable GPU acceleration
  gpu_device: 0 # GPU device ID
  gpu_batch_size: 25_000_000 # 25M points (adjust for your VRAM)
  gpu_memory_target: 0.85 # 85% VRAM utilization
  vram_limit_gb: 10 # Conservative limit for 12GB GPU

  # Chunking for large tiles
  chunk_size: 5_000_000 # 5M points per chunk

  # No parallel workers with GPU
  num_workers: 0 # GPU + multiprocessing = bad

  # Patch settings
  patch_size: 50.0 # 50m Ã— 50m patches
  num_points: 16384 # 16k points per patch
  overlap: 0.1 # 10% overlap

# ============================================================================
# PREPROCESSING
# ============================================================================
preprocess:
  enabled: true
  sor_k: 12
  sor_std: 2.0
  ror_radius: 1.0
  ror_neighbors: 4
  voxel_enabled: false

# ============================================================================
# FEATURES (LOD2 WITH GPU ACCELERATION)
# ============================================================================
features:
  # Feature mode
  mode: "lod2" # ~12 features for building classification

  # Geometric computation
  k_neighbors: 30
  search_radius: 3.0

  # Core features
  compute_normals: true
  compute_curvature: true
  compute_height: true
  compute_geometric: true
  compute_density: true

  # Multi-scale artifact suppression (2 scales for speed)
  multi_scale_computation: true
  scales:
    - name: fine
      k_neighbors: 30
      search_radius: 2.0
      weight: 0.6

    - name: coarse
      k_neighbors: 80
      search_radius: 4.0
      weight: 0.4

  # Aggregation settings
  aggregation_method: "variance_weighted"
  variance_penalty_factor: 2.0
  artifact_variance_threshold: 0.15

  # Disable advanced features
  compute_cluster_id: false
  spectral_features: false

# ============================================================================
# DATA SOURCES (ALL DISABLED FOR OFFLINE PROCESSING)
# ============================================================================
data_sources:
  bd_topo:
    enabled: false

  dtm:
    enabled: false

  orthophoto:
    enabled: false
# ============================================================================
# GPU MEMORY TUNING
# ============================================================================
# For different GPU memory sizes:
#
# 12GB VRAM (RTX 3080 Ti, RTX 3060 12GB):
#   gpu_batch_size: 20_000_000
#   vram_limit_gb: 10
#   chunk_size: 4_000_000
#
# 16GB VRAM (RTX 4080, A5000):
#   gpu_batch_size: 30_000_000
#   vram_limit_gb: 14
#   chunk_size: 5_000_000
#
# 24GB VRAM (RTX 4090, A6000):
#   gpu_batch_size: 50_000_000
#   vram_limit_gb: 22
#   chunk_size: 10_000_000
#
# ============================================================================
# USAGE
# ============================================================================
# ign-lidar-hd process -c examples/quickstart/02_gpu_basic.yaml
#
# For 16GB GPU:
# ign-lidar-hd process -c examples/quickstart/02_gpu_basic.yaml \
#   processor.gpu_batch_size=30000000 \
#   processor.vram_limit_gb=14 \
#   input_dir="/data/tiles"
#
# For 24GB GPU:
# ign-lidar-hd process -c examples/quickstart/02_gpu_basic.yaml \
#   processor.gpu_batch_size=50000000 \
#   processor.vram_limit_gb=22 \
#   input_dir="/data/tiles"
# ============================================================================
