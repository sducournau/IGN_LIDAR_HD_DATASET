---
sidebar_position: 1
title: v2.3.0 - Processing Modes & Custom Configs
---

# Version 2.3.0 - Processing Modes & Custom Configurations

**Release Date:** October 11, 2025

Version 2.3.0 introduces intuitive processing modes and powerful custom configuration management to make workflows clearer and more flexible.

## 🎉 Highlights

- ✨ **Explicit Processing Modes** - Clear, purpose-driven modes replace confusing boolean flags
- 📁 **Custom Configuration Files** - Load complete workflows from YAML files
- 🔄 **Smart Configuration Precedence** - Package defaults < Custom file < CLI overrides
- ⚠️ **Backward Compatible** - Old API still works with deprecation warnings

---

## ✨ New Features

### Processing Modes

Replace confusing `save_enriched_laz` and `only_enriched_laz` boolean flags with three explicit modes:

#### Mode 1: `patches_only` (Default)

Generate only ML training patches:

```bash
ign-lidar-hd process \
  input_dir=data/raw \
  output_dir=data/patches \
  processor.processing_mode=patches_only
```

**Output:** `tile_patch_0001.npz`, `tile_patch_0002.npz`, ...

#### Mode 2: `both`

Generate both patches and enriched LAZ files:

```bash
ign-lidar-hd process \
  input_dir=data/raw \
  output_dir=data/both \
  processor.processing_mode=both
```

**Output:**

- ML patches: `tile_patch_0001.npz`, ...
- GIS files: `tile_enriched.laz`

#### Mode 3: `enriched_only`

Generate only enriched LAZ files (fastest for GIS workflows):

```bash
ign-lidar-hd process \
  input_dir=data/raw \
  output_dir=data/enriched \
  processor.processing_mode=enriched_only
```

**Output:** `tile_enriched.laz` with added features

### Custom Configuration Files

Load complete workflows from YAML configuration files:

```bash
# Use production-ready example configs
ign-lidar-hd process \
  --config-file examples/config_training_dataset.yaml \
  input_dir=data/raw \
  output_dir=data/patches
```

#### New CLI Options

- **`--config-file` / `-c`** - Load configuration from YAML file
- **`--show-config`** - Preview merged configuration without processing

```bash
# Preview configuration before running
ign-lidar-hd process \
  --config-file examples/config_gpu_processing.yaml \
  --show-config \
  input_dir=data/raw \
  output_dir=data/output
```

#### Four Production-Ready Example Configs

Located in `examples/` directory:

1. **`config_gpu_processing.yaml`** - GPU-accelerated LAZ enrichment
   - Use Case: Fast GIS analysis with GPU
   - Features: GPU enabled, enriched LAZ only, full features
2. **`config_training_dataset.yaml`** - ML training dataset creation
   - Use Case: Training deep learning models
   - Features: Augmentation (5x), preprocessing, boundary-consistent features
3. **`config_quick_enrich.yaml`** - Quick LAZ enrichment
   - Use Case: Fast feature enrichment for QGIS/CloudCompare
   - Features: Minimal features, no preprocessing, CPU-based
4. **`config_complete.yaml`** - Complete workflow
   - Use Case: Research projects needing both outputs
   - Features: Both patches and enriched LAZ, full preprocessing

### Configuration Precedence

Clear precedence order for configuration values:

1. **Package Defaults** (lowest) - Built-in defaults from `ign_lidar/configs/`
2. **Custom Config File** (medium) - Values from your `--config-file`
3. **CLI Overrides** (highest) - Parameters passed directly on command line

```bash
# Override config file values from CLI
ign-lidar-hd process \
  --config-file examples/config_training_dataset.yaml \
  input_dir=data/raw \
  output_dir=data/patches \
  processor.num_points=32768  # Overrides config file value
```

---

## 🔄 Changes

### API Changes

#### Processor API

Added `processing_mode` parameter to `LiDARTileProcessor.__init__()`:

```python
# New API (recommended)
processor = LiDARTileProcessor(
    processing_mode="patches_only"
)

# Old API (still works, but deprecated)
processor = LiDARTileProcessor(
    save_enriched_laz=False,
    only_enriched_laz=False
)
```

#### OutputConfig Schema

Added `processing_mode` field to configuration schema:

```yaml
output:
  processing_mode: patches_only # or "both" or "enriched_only"
  format: npz
```

Old fields remain for backward compatibility but default to `None`:

```yaml
output:
  save_enriched_laz: null # Deprecated
  only_enriched_laz: null # Deprecated
```

---

## ⚠️ Deprecations

The following parameters are deprecated and will be removed in **v3.0.0**:

### Python API

- `save_enriched_laz` in `LiDARTileProcessor.__init__()`
- `only_enriched_laz` in `LiDARTileProcessor.__init__()`

**Migration:**

```python
# Old (deprecated)
processor = LiDARTileProcessor(
    save_enriched_laz=True,
    only_enriched_laz=True
)

# New (recommended)
processor = LiDARTileProcessor(
    processing_mode="enriched_only"
)
```

### CLI

- `output.save_enriched_laz=true/false`
- `output.only_enriched_laz=true/false`

**Migration:**

```bash
# Old (deprecated)
ign-lidar-hd process \
  input_dir=data/ \
  output.save_enriched_laz=true \
  output.only_enriched_laz=false

# New (recommended)
ign-lidar-hd process \
  input_dir=data/ \
  processor.processing_mode=both
```

### Migration Table

| Old Flags                                          | New Mode        |
| -------------------------------------------------- | --------------- |
| `save_enriched_laz=False, only_enriched_laz=False` | `patches_only`  |
| `save_enriched_laz=True, only_enriched_laz=False`  | `both`          |
| `save_enriched_laz=True, only_enriched_laz=True`   | `enriched_only` |

### Deprecation Warnings

Using old flags will show helpful warnings:

```
⚠️ DeprecationWarning: Parameter 'save_enriched_laz' is deprecated.
   Use 'processing_mode="both"' or 'processing_mode="enriched_only"' instead.
```

---

## 📖 Documentation

### New Documentation Pages

- **[Processing Modes Guide](/guides/processing-modes)** - Comprehensive guide to the three processing modes
- **[Example Configuration Files](/examples/config-files)** - Detailed documentation of all example configs

### Updated Documentation

- **[Introduction](/intro)** - Updated with v2.3.0 features and examples
- **[Quick Start](/guides/quick-start)** - Added processing modes quick start section
- **[Configuration System](/guides/configuration-system)** - Added custom config file usage

### New Files in Repository

- `examples/README.md` - Usage guide for example configs
- `examples/config_gpu_processing.yaml` - GPU processing config
- `examples/config_training_dataset.yaml` - Training dataset config
- `examples/config_quick_enrich.yaml` - Quick enrichment config
- `examples/config_complete.yaml` - Complete workflow config
- `PROCESSING_MODES_USAGE.md` - Quick reference guide

---

## 💡 Usage Examples

### Example 1: ML Training Dataset

```bash
ign-lidar-hd process \
  --config-file examples/config_training_dataset.yaml \
  input_dir=data/raw_tiles \
  output_dir=data/training
```

**Output:** ML-ready patches with 5x augmentation

### Example 2: GPU-Accelerated GIS

```bash
ign-lidar-hd process \
  --config-file examples/config_gpu_processing.yaml \
  input_dir=data/raw_tiles \
  output_dir=data/enriched
```

**Output:** Enriched LAZ files with GPU acceleration

### Example 3: Quick LAZ Enrichment

```bash
ign-lidar-hd process \
  --config-file examples/config_quick_enrich.yaml \
  input_dir=data/raw_tiles \
  output_dir=data/qgis
```

**Output:** LAZ files with basic features (fastest)

### Example 4: Complete Workflow

```bash
ign-lidar-hd process \
  --config-file examples/config_complete.yaml \
  input_dir=data/raw_tiles \
  output_dir=data/research
```

**Output:** Both ML patches and enriched LAZ files

### Example 5: Custom Override

```bash
ign-lidar-hd process \
  --config-file examples/config_training_dataset.yaml \
  input_dir=data/raw \
  output_dir=data/patches \
  processor.num_points=65536 \
  processor.num_augmentations=10
```

**Output:** Patches with custom point count and augmentation

---

## 🔧 Internal Changes

### Configuration System

- Added `processing_mode` enum: `"patches_only" | "both" | "enriched_only"`
- Updated `OutputConfig` dataclass with `processing_mode` field
- Added backward compatibility layer for old boolean flags
- Implemented deprecation warning system

### Processor Core

- Updated `LiDARTileProcessor.__init__()` to accept `processing_mode`
- Added mode validation and error handling
- Maintained backward compatibility with old flags
- Updated internal logic to use new mode system

### CLI

- Added `--config-file` / `-c` option to `process` command
- Added `--show-config` option for configuration preview
- Integrated custom config loading with Hydra
- Updated help text and examples

---

## 🐛 Bug Fixes

None in this release - focused on feature additions and API improvements.

---

## 🚀 Performance

No performance changes in this release. Processing modes use the same underlying pipeline.

---

## 📊 Comparison with v2.2.1

| Feature                | v2.2.1        | v2.3.0                |
| ---------------------- | ------------- | --------------------- |
| Processing control     | Boolean flags | Explicit modes        |
| Custom configs         | ❌            | ✅ (4 examples)       |
| Config preview         | ❌            | ✅ (`--show-config`)  |
| Config precedence      | Unclear       | Clear 3-tier system   |
| Example configs        | 0             | 4 production-ready    |
| API clarity            | Confusing     | Crystal clear         |
| Backward compatibility | N/A           | ✅ (with deprecation) |

---

## 🔮 What's Next

### v2.3.1 (Planned)

- Bug fixes and stability improvements
- Enhanced error messages for configuration issues

### v2.4.0 (Planned)

- Additional example configs for specific use cases
- Configuration validation improvements
- Enhanced `--show-config` output formatting

### v3.0.0 (Future)

- Remove deprecated `save_enriched_laz` and `only_enriched_laz` parameters
- Configuration system overhaul
- Breaking changes with clear migration path

---

## 📝 Upgrade Instructions

### From v2.2.1 to v2.3.0

1. **Update the package:**

```bash
pip install --upgrade ign-lidar-hd
```

2. **No code changes required** - old API still works with deprecation warnings

3. **Recommended: Migrate to new API**

Update your code to use `processing_mode`:

```python
# Before
processor = LiDARTileProcessor(
    save_enriched_laz=True,
    only_enriched_laz=False
)

# After
processor = LiDARTileProcessor(
    processing_mode="both"
)
```

4. **Try example configs:**

```bash
# Explore the new example configs
ls examples/config*.yaml

# Try one
ign-lidar-hd process \
  --config-file examples/config_training_dataset.yaml \
  input_dir=data/raw \
  output_dir=data/patches
```

---

## 🆘 Troubleshooting

### Issue: "Unknown processing mode"

**Cause:** Typo in mode name

**Solution:** Use exactly: `patches_only`, `both`, or `enriched_only`

### Issue: Deprecation warnings

**Cause:** Using old `save_enriched_laz` or `only_enriched_laz` flags

**Solution:** Migrate to new `processing_mode` parameter (see migration table above)

### Issue: Config file not found

**Cause:** Wrong path to config file

**Solution:** Use absolute path or path relative to current directory:

```bash
# Absolute path
--config-file /full/path/to/config.yaml

# Relative path
--config-file examples/config_training_dataset.yaml

# From examples directory
--config-file ./config_training_dataset.yaml
```

---

## 📚 Related Documentation

- [Processing Modes Guide](/guides/processing-modes) - Complete guide to processing modes
- [Example Configuration Files](/examples/config-files) - Detailed config documentation
- [Configuration System](/guides/configuration-system) - Full config reference
- [Hydra CLI Guide](/guides/hydra-cli) - Advanced CLI usage

---

## 🙏 Acknowledgments

Thank you to all users who provided feedback on the confusing boolean flags. Version 2.3.0 addresses this pain point with a clearer, more intuitive API.

---

## 📦 Package Information

- **PyPI:** `ign-lidar-hd==2.3.0`
- **Python:** 3.8+
- **Dependencies:** No changes from v2.2.1
- **License:** MIT

---

## 🔗 Links

- [GitHub Repository](https://github.com/sducournau/IGN_LIDAR_HD_DATASET)
- [PyPI Package](https://pypi.org/project/ign-lidar-hd/)
- [Documentation](https://sducournau.github.io/IGN_LIDAR_HD_DATASET/)
- [Issue Tracker](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/issues)
- [Changelog](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/blob/main/CHANGELOG.md)

---

**Happy processing! 🚀**
