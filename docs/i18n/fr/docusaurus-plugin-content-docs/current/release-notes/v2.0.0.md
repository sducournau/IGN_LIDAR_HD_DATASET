---
sidebar_position: 1
title: v2.0.0 - Architecture Overhaul
---

<!-- 🇫🇷 TRADUCTION FRANÇAISE REQUISE -->
<!-- Ce fichier est un modèle qui nécessite une traduction manuelle. -->
<!-- Veuillez traduire le contenu ci-dessous en conservant : -->
<!-- - Le frontmatter (métadonnées en haut) -->
<!-- - Les blocs de code (traduire uniquement les commentaires) -->
<!-- - Les liens et chemins de fichiers -->
<!-- - La structure Markdown -->



# v2.0.0 - Complete Architecture Overhaul

**Release Date:** September 2025  
**Type:** Major Release (Breaking Changes)

---

## 🎉 Overview

Version 2.0.0 represents the **most significant update** in the library's history. This release completely redesigns the architecture, introduces a modern CLI system, and adds powerful new features for production workflows.

:::warning Breaking Changes

This is a **major version** with breaking changes. Existing v1.x code will need updates. See the [Migration Guide](/guides/migration-v1-to-v2) for detailed upgrade instructions.

:::

---

## 🏗️ Modular Architecture

The library has been completely restructured into logical modules:

### New Module Structure

```
ign_lidar/
├── core/          # Core processing pipeline
│   ├── processor.py      # Main LiDARProcessor
│   └── pipeline.py       # Unified pipeline
├── features/      # Feature computation
│   ├── computer.py       # Base feature computation
│   ├── gpu_chunked.py    # GPU chunked processing
│   └── boundary.py       # Boundary-aware features
├── preprocessing/ # Data preprocessing
│   ├── outliers.py       # Outlier removal
│   ├── normalization.py  # Ground normalization
│   └── tiling.py         # Tile operations
├── io/            # Input/Output operations
│   ├── laz.py            # LAZ file handling
│   ├── metadata.py       # Metadata management
│   └── stitching.py      # Tile stitching
├── config/        # Configuration management
│   └── hydra_config.py   # Hydra integration
└── configs/       # Hydra configuration files
```

### Benefits

- ✅ **Clear separation of concerns**
- ✅ **Easier to maintain and extend**
- ✅ **Better testability**
- ✅ **Improved code organization**

---

## ⚡ Hydra CLI System

A modern, configuration-based CLI built on [Hydra](https://hydra.cc):

### New Unified Command

```bash
# Single command for the entire pipeline
ign-lidar-hd process \
  input_dir=data/raw/ \
  output_dir=output/ \
  preset=balanced
```

### Configuration Presets

Pre-configured workflows for common scenarios:

- **`fast`**: Quick processing, fewer features (5-10 min/tile)
- **`balanced`**: Standard quality (15-20 min/tile) ⭐ Recommended
- **`quality`**: High quality, all features (30-45 min/tile)
- **`ultra`**: Maximum features, boundary-aware (60+ min/tile)

### Hierarchical Configuration

```bash
# Override any parameter
ign-lidar-hd process \
  preset=balanced \
  processor=gpu \
  features.use_rgb=true \
  num_workers=8
```

### Configuration Files

Use YAML files for complex configurations:

```yaml
# config.yaml
defaults:
  - base_config
  - _self_

input_dir: "/data/urban"
output_dir: "/output/urban"
preset: quality
processor: gpu
features:
  use_rgb: true
  compute_ndvi: true
num_workers: 8
```

```bash
ign-lidar-hd process --config-name config
```

---

## 🔄 Unified Pipeline

**Old (v1.x):** Multi-step process
```bash
# Step 1: Enrich
ign-lidar-hd enrich --input-dir data/ --output enriched/

# Step 2: Patch
ign-lidar-hd patch --input-dir enriched/ --output patches/
```

**New (v2.0):** Single unified pipeline
```bash
# One command does everything!
ign-lidar-hd process input_dir=data/ output_dir=output/
```

### Pipeline Features

- ✅ **Automatic preprocessing**: Ground normalization, outlier removal, etc.
- ✅ **Feature computation**: All geometric and RGB features
- ✅ **Patch generation**: Automatic patch extraction
- ✅ **Metadata tracking**: Complete provenance and statistics
- ✅ **Error recovery**: Robust error handling and logging

---

## 🌐 Boundary-Aware Features

Eliminate edge artifacts in tile-based processing:

### The Problem

Traditional per-tile processing causes **feature discontinuities at tile boundaries** because neighborhoods are incomplete near edges.

### The Solution

Boundary-aware processing:

1. **Loads neighbor tiles** automatically
2. **Computes features** using complete neighborhoods
3. **Trims results** to tile boundaries
4. **Seamless results** across tiles

### Usage

```bash
ign-lidar-hd process \
  input_dir=data/ \
  output_dir=output/ \
  features.boundary_aware=true \
  features.boundary_buffer=10.0
```

### Benefits

- ✅ **No edge artifacts**
- ✅ **Consistent features across tiles**
- ✅ **Better ML training results**
- ✅ **Automatic neighbor detection**

---

## 🧩 Tile Stitching

Multi-tile dataset workflows:

### Features

- **Automatic neighbor detection** from filenames
- **Cross-tile feature computation**
- **Stitched dataset generation**
- **Metadata consolidation**

### Usage

```bash
# Process multiple tiles with stitching
ign-lidar-hd process \
  input_dir=tiles/ \
  output_dir=output/ \
  stitching=full \
  features.boundary_aware=true
```

### Stitching Modes

- **`none`**: Independent tile processing
- **`features`**: Boundary-aware features only
- **`full`**: Complete stitching with merged datasets

---

## 🤖 Multi-Architecture Support

Support for multiple ML architectures:

### Supported Architectures

1. **PointNet++** (default)
   - Hierarchical point set learning
   - Best for general purpose

2. **Octree Networks**
   - Hierarchical spatial partitioning
   - Memory efficient

3. **Transformers**
   - Attention-based learning
   - Captures long-range dependencies

4. **Sparse Convolutional**
   - Efficient 3D convolutions
   - Best for dense scenes

### Usage

```bash
# Generate patches for specific architecture
ign-lidar-hd process \
  input_dir=data/ \
  output_dir=output/ \
  dataset.architecture=octree
```

---

## 📊 Enhanced Datasets

New dataset classes for different architectures:

```python
from ign_lidar.datasets import MultiArchDataset

# Automatically loads correct format
dataset = MultiArchDataset(
    data_dir="output/patches/",
    architecture="pointnet++",  # or 'octree', 'transformer', 'sparse_conv'
    transform=None
)
```

---

## 🔧 Improved APIs

### LiDARProcessor Class

```python
from ign_lidar.core import LiDARProcessor

processor = LiDARProcessor(
    input_dir="data/",
    output_dir="output/",
    preset="balanced",
    use_gpu=True
)

# Run entire pipeline
processor.run()
```

### Feature Computer

```python
from ign_lidar.features import FeatureComputer

computer = FeatureComputer(
    use_rgb=True,
    compute_ndvi=True,
    boundary_aware=True
)

features = computer.compute(points, colors)
```

### Preprocessing

```python
from ign_lidar.preprocessing import (
    remove_outliers,
    normalize_ground,
    filter_by_classification
)

# Clean preprocessing API
points = remove_outliers(points, method="statistical")
points = normalize_ground(points, max_distance=5.0)
points = filter_by_classification(points, keep_classes=[2, 3, 4, 5, 6])
```

---

## 📝 Import Path Changes

### Old (v1.x)

```python
from ign_lidar import LiDARProcessor
from ign_lidar import FeatureComputer
```

### New (v2.0)

```python
from ign_lidar.core import LiDARProcessor
from ign_lidar.features import FeatureComputer
from ign_lidar.preprocessing import remove_outliers
from ign_lidar.io import read_laz_file, write_laz_file
```

---

## ⚙️ Configuration System

### Hydra Configuration

All configurations managed through Hydra:

```
ign_lidar/configs/
├── config.yaml              # Root config
├── preset/
│   ├── fast.yaml
│   ├── balanced.yaml
│   ├── quality.yaml
│   └── ultra.yaml
├── processor/
│   ├── cpu.yaml
│   └── gpu.yaml
├── features/
│   ├── basic.yaml
│   ├── standard.yaml
│   └── full.yaml
└── preprocess/
    ├── minimal.yaml
    ├── standard.yaml
    └── aggressive.yaml
```

### Benefits

- ✅ **Type-safe configurations**
- ✅ **Composable presets**
- ✅ **Easy experimentation**
- ✅ **Reproducible runs**

---

## 🚀 Performance Improvements

### GPU Processing

- **Chunked processing**: Handle large tiles efficiently
- **Memory optimization**: Automatic chunk size calculation
- **Better utilization**: 90%+ GPU usage
- **Stability fixes**: Robust error handling

### Parallel Processing

- **Multi-worker support**: Process multiple tiles in parallel
- **Queue management**: Efficient task distribution
- **Memory-aware**: Automatic worker scaling

---

## 📦 Output Options

Three output modes:

### 1. Patches Only (default)

```bash
ign-lidar-hd process input_dir=data/ output=patches
```

Generates:
- `patches/` - Ready for ML training
- `metadata.json` - Statistics and provenance

### 2. Enriched LAZ + Patches

```bash
ign-lidar-hd process input_dir=data/ output=both
```

Generates:
- `enriched/` - LAZ files with features
- `patches/` - ML-ready patches
- `metadata.json`

### 3. Enriched LAZ Only (v2.0.1)

```bash
ign-lidar-hd process input_dir=data/ output=enriched_only
```

Generates:
- `enriched/` - LAZ files with features (no patches)
- `metadata.json`

---

## 🛠️ Developer Improvements

### Better Testing

- **Modular tests**: Test individual components
- **Integration tests**: End-to-end workflow testing
- **GPU tests**: Separate GPU test suite

### Better Logging

- **Structured logging**: JSON-compatible logs
- **Progress tracking**: Real-time progress bars
- **Error context**: Detailed error messages

### Better Documentation

- **API documentation**: Complete docstrings
- **Type hints**: Full type annotation
- **Examples**: Comprehensive examples

---

## 🔄 Backward Compatibility

### Legacy CLI Still Works

```bash
# Old commands still work!
ign-lidar-hd enrich --input-dir data/ --output output/
ign-lidar-hd patch --input-dir enriched/ --output patches/
```

### Gradual Migration

- Use legacy CLI while learning new system
- Migrate at your own pace
- Both systems fully supported

---

## 📚 Migration Guide

See the complete [Migration Guide](/guides/migration-v1-to-v2) for:

- ✅ **Command migration table**
- ✅ **Import path updates**
- ✅ **Configuration examples**
- ✅ **Common patterns**
- ✅ **Troubleshooting**

---

## 🐛 Bug Fixes

- Fixed GPU memory leaks in long-running processes
- Fixed NDVI computation for invalid color values
- Fixed patch boundary issues in dense scenes
- Fixed metadata serialization for large datasets
- Improved error messages and stack traces

---

## 📦 Dependencies

### Updated

- `hydra-core>=1.3.0` - Configuration management
- `laspy>=2.5.0` - LAZ file handling
- `numpy>=1.24.0` - Core computations

### New

- `omegaconf>=2.3.0` - Configuration dataclasses
- `rich>=13.0.0` - Beautiful terminal output

---

## 🎓 Learning Resources

### New Guides

- [Hydra CLI Guide](/guides/hydra-cli)
- [Configuration System](/guides/configuration-system)
- [Boundary-Aware Features](/features/boundary-aware)
- [Tile Stitching](/features/tile-stitching)
- [Multi-Architecture Support](/features/multi-architecture)

### Updated Guides

- [Quick Start](/guides/quick-start)
- [Complete Workflow](/guides/complete-workflow)
- [API Reference](/api/core-module)

---

## 🙏 Acknowledgments

This major release was made possible by:

- Community feedback and feature requests
- Extensive testing on real-world datasets
- Contributions from the open-source community

---

## 📞 Support

- **Documentation:** https://ign-lidar-hd.readthedocs.io
- **Issues:** https://github.com/sducournau/IGN_LIDAR_HD_DATASET/issues
- **Discussions:** https://github.com/sducournau/IGN_LIDAR_HD_DATASET/discussions

---

## 🎉 What's Next?

See the [Roadmap](https://github.com/sducournau/IGN_LIDAR_HD_DATASET#roadmap) for upcoming features:

- Cloud-native processing (AWS, Azure, GCP)
- Distributed processing with Dask
- Real-time processing pipelines
- Additional ML architectures

---

**Upgrade today and experience the power of v2.0!** 🚀
