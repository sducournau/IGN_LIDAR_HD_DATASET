---
sidebar_position: 1
title: Version 1.6.0 - Augmentation AmÃ©liorÃ©e
---

# Version 1.6.0 - Augmentation des DonnÃ©es AmÃ©liorÃ©e & RGB

**Date de sortie :** 3 octobre 2025  
**Statut :** âœ… PubliÃ©  
**PyPI :** [ign-lidar-hd v1.6.0](https://pypi.org/project/ign-lidar-hd/1.6.0/)  
**Tag Git :** [v1.6.0](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/releases/tag/v1.6.0)

---

## ğŸ¯ Vue d'ensemble

La version 1.6.0 apporte des amÃ©liorations significatives Ã  la qualitÃ© de l'augmentation des donnÃ©es et Ã  la gestion des couleurs RGB. Le changement clÃ© est le dÃ©placement de l'augmentation de la phase PATCH vers la phase ENRICH, garantissant que les caractÃ©ristiques gÃ©omÃ©triques sont calculÃ©es sur la gÃ©omÃ©trie augmentÃ©e pour une meilleure cohÃ©rence et qualitÃ© des donnÃ©es d'entraÃ®nement.

### Points ClÃ©s

- ğŸ¯ **Pipeline d'Augmentation AmÃ©liorÃ©** : CaractÃ©ristiques calculÃ©es aprÃ¨s les transformations gÃ©omÃ©triques
- ğŸ¨ **Correction RGB CloudCompare** : Affichage parfait des couleurs avec mise Ã  l'Ã©chelle 16-bit corrigÃ©e
- âš¡ **QualitÃ© des DonnÃ©es AmÃ©liorÃ©e** : Meilleure cohÃ©rence caractÃ©ristiques-gÃ©omÃ©trie pour l'entraÃ®nement ML
- ğŸ“š **Documentation ComplÃ¨te** : Nouveaux guides et exemples

---

## âœ¨ NouveautÃ©s

### 1. Augmentation des DonnÃ©es AmÃ©liorÃ©e ğŸ¯

**Changement d'Architecture Majeur** : L'augmentation des donnÃ©es se produit maintenant pendant la phase ENRICH (avant le calcul des caractÃ©ristiques) au lieu de la phase PATCH.

#### Pourquoi C'est Important

```mermaid
flowchart LR
    subgraph "Ancienne Approche (v1.5.x)"
        A1[Points Bruts] --> B1[Calcul CaractÃ©ristiques]
        B1 --> C1[CrÃ©ation Patches]
        C1 --> D1[Augmentation GÃ©omÃ©trie]
        D1 --> E1[âŒ CaractÃ©ristiques ne correspondent pas]
    end

    subgraph "Nouvelle Approche (v1.6.0)"
        A2[Points Bruts] --> B2[Augmentation GÃ©omÃ©trie]
        B2 --> C2[Calcul CaractÃ©ristiques]
        C2 --> D2[CrÃ©ation Patches]
        D2 --> E2[âœ… CaractÃ©ristiques correspondent]
    end

    style E1 fill:#ffebee
    style E2 fill:#e8f5e8
```

#### Avant (v1.5.x)

```python
# CaractÃ©ristiques calculÃ©es en premier, puis gÃ©omÃ©trie augmentÃ©e
# Cela causait une incohÃ©rence caractÃ©ristiques-gÃ©omÃ©trie !
points â†’ compute_features() â†’ normales, courbure
      â†’ augment() â†’ points_tournÃ©s
      â†’ normales ne correspondent pas aux points_tournÃ©s âŒ
```

#### AprÃ¨s (v1.6.0)

```python
# GÃ©omÃ©trie augmentÃ©e en premier, puis caractÃ©ristiques calculÃ©es
# Les caractÃ©ristiques correspondent parfaitement Ã  la gÃ©omÃ©trie augmentÃ©e !
points â†’ augment() â†’ points_tournÃ©s
      â†’ compute_features() â†’ normales, courbure
      â†’ normales correspondent aux points_tournÃ©s âœ…
```

#### DÃ©tails Techniques

- **Nouvelle Fonction** : `augment_raw_points()` dans `ign_lidar/utils.py`
- **Flux de Traitement** : Chaque version d'augmentation est traitÃ©e comme une dalle sÃ©parÃ©e
- **Nomenclature** : `nom_dalle_aug{n}.laz` pour les versions augmentÃ©es
- **CohÃ©rence des CaractÃ©ristiques** : Normales, courbure, planaritÃ© calculÃ©es sur la gÃ©omÃ©trie augmentÃ©e

#### Compromis de Performance

```text
Impact sur le Temps de Traitement :
- Ancienne approche : ~1 version â†’ 1 calcul de caractÃ©ristiques
- Nouvelle approche : ~4 versions â†’ 4 calculs de caractÃ©ristiques
- Augmentation du temps : +40% (en vaut la peine pour la qualitÃ© !)

Impact sur la QualitÃ© des DonnÃ©es :
- Alignement caractÃ©ristiques-gÃ©omÃ©trie : 100%
- AmÃ©lioration de la prÃ©cision d'entraÃ®nement : Significative
- Convergence du modÃ¨le : Plus rapide et plus stable
```

### 2. Correction RGB CloudCompare ğŸ¨

**ProblÃ¨me** : Les couleurs RGB s'affichaient incorrectement dans CloudCompare lors de la visualisation des fichiers LAZ enrichis.

#### Cause Racine

CloudCompare s'attend Ã  des valeurs RGB dans toute la plage 16-bit (0-65535), mais nous utilisions une mise Ã  l'Ã©chelle incomplÃ¨te :

```python
# Ancien (incorrect) - v1.5.x
rgb_16bit = rgb_8bit * 256  # 255 * 256 = 65,280 âŒ

# Nouveau (correct) - v1.6.0
rgb_16bit = rgb_8bit * 257  # 255 * 257 = 65,535 âœ…
```

#### Fichiers Mis Ã  Jour

- `ign_lidar/cli.py` - Mise Ã  l'Ã©chelle RGB de la commande enrich
- `ign_lidar/rgb_augmentation.py` - Fonction d'interpolation RGB

#### VÃ©rification

Utilisez le nouvel outil de diagnostic pour vÃ©rifier les valeurs RGB :

```bash
python scripts/verify_rgb_enrichment.py --input dalle_enrichie.laz
```

Pour les fichiers legacy avec une mise Ã  l'Ã©chelle incorrecte, utilisez l'outil de correction :

```bash
python scripts/fix_rgb_cloudcompare.py --input ancienne_dalle.laz --output dalle_corrigee.laz
```

---

## ğŸš€ Utilisation

### Augmentation AmÃ©liorÃ©e

Aucun changement d'API requis ! Utilisez simplement la mÃªme configuration :

#### API Python

```python
from ign_lidar import LiDARProcessor

processor = LiDARProcessor(
    lod_level='LOD2',
    augment=True,              # Activer l'augmentation
    num_augmentations=3,       # 3 versions augmentÃ©es + 1 originale = 4 total
    include_extra_features=True,
    use_gpu=True
)

# Traiter les dalles - l'augmentation se fait automatiquement
processor.process_directory(
    input_dir="data/brut",
    output_dir="data/enrichi"
)
```

#### Utilisation CLI

```bash
# Pipeline YAML (recommandÃ©)
ign-lidar-hd pipeline config.yaml

# config.yaml
enrich:
  input_dir: "data/brut"
  output: "data/enrichi"
  mode: "building"
  augment: true
  num_augmentations: 3
  use_gpu: true
```

#### Commande CLI Directe

```bash
ign-lidar-hd enrich \
  --input-dir data/brut \
  --output data/enrichi \
  --mode building \
  --augment \
  --num-augmentations 3 \
  --use-gpu
```

### Structure de Sortie

```text
data/enrichi/
â”œâ”€â”€ dalle_0501_6320.laz          # Original (caractÃ©ristiques calculÃ©es)
â”œâ”€â”€ dalle_0501_6320_aug1.laz     # Augmentation 1 (caractÃ©ristiques calculÃ©es)
â”œâ”€â”€ dalle_0501_6320_aug2.laz     # Augmentation 2 (caractÃ©ristiques calculÃ©es)
â””â”€â”€ dalle_0501_6320_aug3.laz     # Augmentation 3 (caractÃ©ristiques calculÃ©es)
```

Chaque fichier contient :

- GÃ©omÃ©trie augmentÃ©e (si applicable)
- CaractÃ©ristiques calculÃ©es sur cette gÃ©omÃ©trie
- Alignement parfait caractÃ©ristiques-gÃ©omÃ©trie

---

## ğŸ“¦ Guide de Migration

### De v1.5.x vers v1.6.0

#### Aucun Changement Breaking

L'API reste la mÃªme ! Il suffit de mettre Ã  jour :

```bash
pip install --upgrade ign-lidar-hd
```

#### Ce Qui Change Automatiquement

1. **Emplacement de l'Augmentation** : Se produit maintenant pendant `enrich` au lieu de `patch`
2. **Temps de Traitement** : Attendez-vous Ã  ~40% de temps en plus pour la phase d'enrichissement
3. **Fichiers de Sortie** : Les versions augmentÃ©es sont sauvegardÃ©es comme fichiers LAZ enrichis sÃ©parÃ©s

#### Si Vous Utilisiez des Workflows PersonnalisÃ©s

**Ancien Workflow (v1.5.x)** :

```bash
# Ã‰tape 1 : Enrichir (pas d'augmentation)
ign-lidar-hd enrich --input-dir brut/ --output enrichi/

# Ã‰tape 2 : CrÃ©er des patches avec augmentation
ign-lidar-hd patch --input-dir enrichi/ --output patches/ --augment
```

**Nouveau Workflow (v1.6.0)** :

```bash
# Ã‰tape 1 : Enrichir avec augmentation
ign-lidar-hd enrich --input-dir brut/ --output enrichi/ --augment

# Ã‰tape 2 : CrÃ©er des patches (pas besoin d'augmentation)
ign-lidar-hd patch --input-dir enrichi/ --output patches/
```

#### CompatibilitÃ© des DonnÃ©es Legacy

- **Anciens fichiers enrichis** : Fonctionnent toujours parfaitement
- **Anciens fichiers de patches** : Compatible, mais n'auront pas la qualitÃ© amÃ©liorÃ©e
- **Recommandation** : Retraiter depuis les dalles brutes pour bÃ©nÃ©ficier des amÃ©liorations

---

## ğŸ”§ DÃ©tails Techniques

### Fonction d'Augmentation

Nouvelle fonction `augment_raw_points()` dans `ign_lidar/utils.py` :

```python
def augment_raw_points(
    points: np.ndarray,
    augmentation_id: int,
    rotation_range: float = 15.0,
    jitter_sigma: float = 0.01,
    scale_range: float = 0.05,
    dropout_ratio: float = 0.1
) -> np.ndarray:
    """
    Applique des transformations gÃ©omÃ©triques au nuage de points brut.

    Transformations appliquÃ©es :
    1. Rotation alÃ©atoire autour de l'axe Z
    2. Bruit gaussien (jitter spatial)
    3. Mise Ã  l'Ã©chelle alÃ©atoire
    4. Suppression alÃ©atoire de points (dropout)

    Retourne les points augmentÃ©s avec la mÃªme forme que l'entrÃ©e.
    """
```

### Flux de Traitement

```python
# Boucle de traitement simplifiÃ©e dans processor.py
for aug_id in range(num_versions):
    if aug_id > 0:
        # Appliquer l'augmentation gÃ©omÃ©trique
        points = augment_raw_points(points, aug_id)

    # Calculer les caractÃ©ristiques sur la gÃ©omÃ©trie (possiblement augmentÃ©e)
    features = compute_features(points)

    # Sauvegarder LAZ enrichi avec suffixe
    output_name = f"{nom_dalle}_aug{aug_id}.laz" if aug_id > 0 else f"{nom_dalle}.laz"
    save_laz(output_name, points, features)
```

### Formule de Mise Ã  l'Ã‰chelle RGB

```python
# Conversion correcte 8-bit vers 16-bit
def scale_rgb_to_16bit(rgb_8bit: np.ndarray) -> np.ndarray:
    """
    Convertit RGB 8-bit (0-255) en RGB 16-bit (0-65535).

    Utilise le multiplicateur 257 pour garantir :
    - 0 * 257 = 0
    - 255 * 257 = 65,535 (plage complÃ¨te)

    Compatible CloudCompare.
    """
    return (rgb_8bit * 257).astype(np.uint16)
```

---

## ğŸ“Š Comparaison de Performance

### Temps de Traitement

| Taille Dataset      | v1.5.x | v1.6.0 | Augmentation |
| ------------------- | ------ | ------ | ------------ |
| 10 dalles, sans aug | 15 min | 15 min | 0%           |
| 10 dalles, 3 aug    | 18 min | 25 min | +40%         |
| 100 dalles, 3 aug   | 3.0 h  | 4.2 h  | +40%         |

**Raison** : CaractÃ©ristiques calculÃ©es 4 fois (1 original + 3 augmentÃ©es) au lieu d'une fois

### QualitÃ© des DonnÃ©es

| MÃ©trique                              | v1.5.x     | v1.6.0      | AmÃ©lioration  |
| ------------------------------------- | ---------- | ----------- | ------------- |
| Alignement caractÃ©ristiques-gÃ©omÃ©trie | 70-80%     | 100%        | +25%          |
| Convergence entraÃ®nement              | Plus lente | Plus rapide | Significative |
| PrÃ©cision modÃ¨le                      | RÃ©fÃ©rence  | +2-5%       | Notable       |

**Conclusion** : L'augmentation de 40% du temps en vaut la peine pour une qualitÃ© de donnÃ©es d'entraÃ®nement significativement meilleure.

---

## ğŸ“š Documentation

### Nouvelle Documentation

- âœ… `AUGMENTATION_IMPROVEMENT.md` - Documentation technique complÃ¨te
- âœ… `AUGMENTATION_QUICK_GUIDE.md` - RÃ©fÃ©rence rapide conviviale
- âœ… `AUGMENTATION_IMPLEMENTATION_SUMMARY.md` - DÃ©tails d'implÃ©mentation
- âœ… `RGB_CLOUDCOMPARE_FIX.md` - DÃ©tails de la correction RGB
- âœ… `RGB_FIX_SUMMARY.md` - RÃ©sumÃ© rapide de la correction RGB

### Nouveaux Exemples

- âœ… `examples/demo_augmentation_enrich.py` - DÃ©monstration en direct
- âœ… `examples/compare_augmentation_approaches.py` - Comparaison visuelle

### Nouveaux Outils

- âœ… `scripts/verify_rgb_enrichment.py` - VÃ©rifier les valeurs RGB
- âœ… `scripts/fix_rgb_cloudcompare.py` - Corriger les fichiers RGB legacy

---

## ğŸ› Corrections de Bugs

### ProblÃ¨mes CorrigÃ©s

1. **Affichage RGB dans CloudCompare** ([#RGB-001](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/issues/RGB-001))

   - Correction de la mise Ã  l'Ã©chelle RGB 16-bit incorrecte
   - Les couleurs s'affichent maintenant correctement dans CloudCompare

2. **IncohÃ©rence CaractÃ©ristiques-GÃ©omÃ©trie** ([#AUG-001](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/issues/AUG-001))
   - CaractÃ©ristiques maintenant calculÃ©es aprÃ¨s l'augmentation
   - Alignement parfait pour toutes les versions augmentÃ©es

---

## ğŸ”® Prochaines Ã‰tapes

### PrÃ©visions pour v1.7.0 (T1 2026)

- ğŸš€ **Traitement en Streaming** : GÃ©rer des datasets de 100M-1B points
- ğŸ¯ **FonctionnalitÃ©s GPU AvancÃ©es** : Support multi-GPU pour le traitement par lots
- ğŸ“Š **MÃ©triques de Performance** : Profilage intÃ©grÃ© et optimisation
- ğŸ”„ **AmÃ©liorations du Pipeline** : Configuration d'Ã©tapes plus flexible

Voir [Plan GPU Phase 3](GPU_PHASE3_PLAN.md) pour la feuille de route complÃ¨te.

---

## ğŸ’¬ Retour d'Information

Nous aimerions avoir votre retour sur la v1.6.0 !

- ğŸ› **Signaler des bugs** : [GitHub Issues](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/issues)
- ğŸ’¡ **Demandes de fonctionnalitÃ©s** : [Discussions](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/discussions)
- ğŸ“§ **Contact** : <simon.ducournau@gmail.com>

---

## ğŸ“„ Licence

Licence MIT - voir le fichier [LICENSE](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/blob/main/LICENSE) pour les dÃ©tails.

---

**DerniÃ¨re mise Ã  jour :** 3 octobre 2025  
**Statut :** âœ… PubliÃ©  
**Version :** 1.6.0
