---
sidebar_position: 1
title: Version 1.6.0 - Augmentation Am√©lior√©e
---

# Version 1.6.0 - Augmentation des Donn√©es Am√©lior√©e & RGB

**Date de sortie :** 3 octobre 2025  
**Statut :** ‚úÖ Publi√©  
**PyPI :** [ign-lidar-hd v1.6.0](https://pypi.org/project/ign-lidar-hd/1.6.0/)  
**Tag Git :** [v1.6.0](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/releases/tag/v1.6.0)

---

## üéØ Vue d'ensemble

La version 1.6.0 apporte des am√©liorations significatives √† la qualit√© de l'augmentation des donn√©es et √† la gestion des couleurs RGB. Le changement cl√© est le d√©placement de l'augmentation de la phase PATCH vers la phase ENRICH, garantissant que les caract√©ristiques g√©om√©triques sont calcul√©es sur la g√©om√©trie augment√©e pour une meilleure coh√©rence et qualit√© des donn√©es d'entra√Ænement.

### Points Cl√©s

- üéØ **Pipeline d'Augmentation Am√©lior√©** : Caract√©ristiques calcul√©es apr√®s les transformations g√©om√©triques
- üé® **Correction RGB CloudCompare** : Affichage parfait des couleurs avec mise √† l'√©chelle 16-bit corrig√©e
- ‚ö° **Qualit√© des Donn√©es Am√©lior√©e** : Meilleure coh√©rence caract√©ristiques-g√©om√©trie pour l'entra√Ænement ML
- üìö **Documentation Compl√®te** : Nouveaux guides et exemples

---

## ‚ú® Nouveaut√©s

### 1. Augmentation des Donn√©es Am√©lior√©e üéØ

**Changement d'Architecture Majeur** : L'augmentation des donn√©es se produit maintenant pendant la phase ENRICH (avant le calcul des caract√©ristiques) au lieu de la phase PATCH.

#### Pourquoi C'est Important

```mermaid
flowchart LR
    subgraph "Ancienne Approche (v1.5.x)"
        A1[Points Bruts] --> B1[Calcul Caract√©ristiques]
        B1 --> C1[Cr√©ation Patches]
        C1 --> D1[Augmentation G√©om√©trie]
        D1 --> E1[‚ùå Caract√©ristiques ne correspondent pas]
    end

    subgraph "Nouvelle Approche (v1.6.0)"
        A2[Points Bruts] --> B2[Augmentation G√©om√©trie]
        B2 --> C2[Calcul Caract√©ristiques]
        C2 --> D2[Cr√©ation Patches]
        D2 --> E2[‚úÖ Caract√©ristiques correspondent]
    end

    style E1 fill:#ffebee
    style E2 fill:#e8f5e8
```

#### Avant (v1.5.x)

```python
# Caract√©ristiques calcul√©es en premier, puis g√©om√©trie augment√©e
# Cela causait une incoh√©rence caract√©ristiques-g√©om√©trie !
points ‚Üí compute_features() ‚Üí normales, courbure
      ‚Üí augment() ‚Üí points_tourn√©s
      ‚Üí normales ne correspondent pas aux points_tourn√©s ‚ùå
```

#### Apr√®s (v1.6.0)

```python
# G√©om√©trie augment√©e en premier, puis caract√©ristiques calcul√©es
# Les caract√©ristiques correspondent parfaitement √† la g√©om√©trie augment√©e !
points ‚Üí augment() ‚Üí points_tourn√©s
      ‚Üí compute_features() ‚Üí normales, courbure
      ‚Üí normales correspondent aux points_tourn√©s ‚úÖ
```

#### D√©tails Techniques

- **Nouvelle Fonction** : `augment_raw_points()` dans `ign_lidar/utils.py`
- **Flux de Traitement** : Chaque version d'augmentation est trait√©e comme une dalle s√©par√©e
- **Nomenclature** : `nom_dalle_aug{n}.laz` pour les versions augment√©es
- **Coh√©rence des Caract√©ristiques** : Normales, courbure, planarit√© calcul√©es sur la g√©om√©trie augment√©e

#### Compromis de Performance

```text
Impact sur le Temps de Traitement :
- Ancienne approche : ~1 version ‚Üí 1 calcul de caract√©ristiques
- Nouvelle approche : ~4 versions ‚Üí 4 calculs de caract√©ristiques
- Augmentation du temps : +40% (en vaut la peine pour la qualit√© !)

Impact sur la Qualit√© des Donn√©es :
- Alignement caract√©ristiques-g√©om√©trie : 100%
- Am√©lioration de la pr√©cision d'entra√Ænement : Significative
- Convergence du mod√®le : Plus rapide et plus stable
```

### 2. Correction RGB CloudCompare üé®

**Probl√®me** : Les couleurs RGB s'affichaient incorrectement dans CloudCompare lors de la visualisation des fichiers LAZ enrichis.

#### Cause Racine

CloudCompare s'attend √† des valeurs RGB dans toute la plage 16-bit (0-65535), mais nous utilisions une mise √† l'√©chelle incompl√®te :

```python
# Ancien (incorrect) - v1.5.x
rgb_16bit = rgb_8bit * 256  # 255 * 256 = 65,280 ‚ùå

# Nouveau (correct) - v1.6.0
rgb_16bit = rgb_8bit * 257  # 255 * 257 = 65,535 ‚úÖ
```

#### Fichiers Mis √† Jour

- `ign_lidar/cli.py` - Mise √† l'√©chelle RGB de la commande enrich
- `ign_lidar/rgb_augmentation.py` - Fonction d'interpolation RGB

#### V√©rification

Utilisez le nouvel outil de diagnostic pour v√©rifier les valeurs RGB :

```bash
python scripts/verify_rgb_enrichment.py --input dalle_enrichie.laz
```

Pour les fichiers legacy avec une mise √† l'√©chelle incorrecte, utilisez l'outil de correction :

```bash
python scripts/fix_rgb_cloudcompare.py --input ancienne_dalle.laz --output dalle_corrigee.laz
```

---

## üöÄ Utilisation

### Augmentation Am√©lior√©e

Aucun changement d'API requis ! Utilisez simplement la m√™me configuration :

#### API Python

```python
from ign_lidar import LiDARProcessor

processor = LiDARProcessor(
    lod_level='LOD2',
    augment=True,              # Activer l'augmentation
    num_augmentations=3,       # 3 versions augment√©es + 1 originale = 4 total
    include_extra_features=True,
    use_gpu=True
)

# Traiter les dalles - l'augmentation se fait automatiquement
processor.process_directory(
    input_dir="data/brut",
    output_dir="data/enrichi"
)
```

#### Utilisation CLI

```bash
# Pipeline YAML (recommand√©)
ign-lidar-hd pipeline config.yaml

# config.yaml
enrich:
  input_dir: "data/brut"
  output: "data/enrichi"
  mode: "building"
  augment: true
  num_augmentations: 3
  use_gpu: true
```

#### Commande CLI Directe

```bash
ign-lidar-hd enrich \
  --input-dir data/brut \
  --output data/enrichi \
  --mode building \
  --augment \
  --num-augmentations 3 \
  --use-gpu
```

### Structure de Sortie

```text
data/enrichi/
‚îú‚îÄ‚îÄ dalle_0501_6320.laz          # Original (caract√©ristiques calcul√©es)
‚îú‚îÄ‚îÄ dalle_0501_6320_aug1.laz     # Augmentation 1 (caract√©ristiques calcul√©es)
‚îú‚îÄ‚îÄ dalle_0501_6320_aug2.laz     # Augmentation 2 (caract√©ristiques calcul√©es)
‚îî‚îÄ‚îÄ dalle_0501_6320_aug3.laz     # Augmentation 3 (caract√©ristiques calcul√©es)
```

Chaque fichier contient :

- G√©om√©trie augment√©e (si applicable)
- Caract√©ristiques calcul√©es sur cette g√©om√©trie
- Alignement parfait caract√©ristiques-g√©om√©trie

---

## üì¶ Guide de Migration

### De v1.5.x vers v1.6.0

#### Aucun Changement Breaking

L'API reste la m√™me ! Il suffit de mettre √† jour :

```bash
pip install --upgrade ign-lidar-hd
```

#### Ce Qui Change Automatiquement

1. **Emplacement de l'Augmentation** : Se produit maintenant pendant `enrich` au lieu de `patch`
2. **Temps de Traitement** : Attendez-vous √† ~40% de temps en plus pour la phase d'enrichissement
3. **Fichiers de Sortie** : Les versions augment√©es sont sauvegard√©es comme fichiers LAZ enrichis s√©par√©s

#### Si Vous Utilisiez des Workflows Personnalis√©s

**Ancien Workflow (v1.5.x)** :

```bash
# √âtape 1 : Enrichir (pas d'augmentation)
ign-lidar-hd enrich --input-dir brut/ --output enrichi/

# √âtape 2 : Cr√©er des patches avec augmentation
ign-lidar-hd patch --input-dir enrichi/ --output patches/ --augment
```

**Nouveau Workflow (v1.6.0)** :

```bash
# √âtape 1 : Enrichir avec augmentation
ign-lidar-hd enrich --input-dir brut/ --output enrichi/ --augment

# √âtape 2 : Cr√©er des patches (pas besoin d'augmentation)
ign-lidar-hd patch --input-dir enrichi/ --output patches/
```

#### Compatibilit√© des Donn√©es Legacy

- **Anciens fichiers enrichis** : Fonctionnent toujours parfaitement
- **Anciens fichiers de patches** : Compatible, mais n'auront pas la qualit√© am√©lior√©e
- **Recommandation** : Retraiter depuis les dalles brutes pour b√©n√©ficier des am√©liorations

---

## üîß D√©tails Techniques

### Fonction d'Augmentation

Nouvelle fonction `augment_raw_points()` dans `ign_lidar/utils.py` :

```python
def augment_raw_points(
    points: np.ndarray,
    augmentation_id: int,
    rotation_range: float = 15.0,
    jitter_sigma: float = 0.01,
    scale_range: float = 0.05,
    dropout_ratio: float = 0.1
) -> np.ndarray:
    """
    Applique des transformations g√©om√©triques au nuage de points brut.

    Transformations appliqu√©es :
    1. Rotation al√©atoire autour de l'axe Z
    2. Bruit gaussien (jitter spatial)
    3. Mise √† l'√©chelle al√©atoire
    4. Suppression al√©atoire de points (dropout)

    Retourne les points augment√©s avec la m√™me forme que l'entr√©e.
    """
```

### Flux de Traitement

```python
# Boucle de traitement simplifi√©e dans processor.py
for aug_id in range(num_versions):
    if aug_id > 0:
        # Appliquer l'augmentation g√©om√©trique
        points = augment_raw_points(points, aug_id)

    # Calculer les caract√©ristiques sur la g√©om√©trie (possiblement augment√©e)
    features = compute_features(points)

    # Sauvegarder LAZ enrichi avec suffixe
    output_name = f"{nom_dalle}_aug{aug_id}.laz" if aug_id > 0 else f"{nom_dalle}.laz"
    save_laz(output_name, points, features)
```

### Formule de Mise √† l'√âchelle RGB

```python
# Conversion correcte 8-bit vers 16-bit
def scale_rgb_to_16bit(rgb_8bit: np.ndarray) -> np.ndarray:
    """
    Convertit RGB 8-bit (0-255) en RGB 16-bit (0-65535).

    Utilise le multiplicateur 257 pour garantir :
    - 0 * 257 = 0
    - 255 * 257 = 65,535 (plage compl√®te)

    Compatible CloudCompare.
    """
    return (rgb_8bit * 257).astype(np.uint16)
```

---

## üìä Comparaison de Performance

### Temps de Traitement

| Taille Dataset      | v1.5.x | v1.6.0 | Augmentation |
| ------------------- | ------ | ------ | ------------ |
| 10 dalles, sans aug | 15 min | 15 min | 0%           |
| 10 dalles, 3 aug    | 18 min | 25 min | +40%         |
| 100 dalles, 3 aug   | 3.0 h  | 4.2 h  | +40%         |

**Raison** : Caract√©ristiques calcul√©es 4 fois (1 original + 3 augment√©es) au lieu d'une fois

### Qualit√© des Donn√©es

| M√©trique                              | v1.5.x     | v1.6.0      | Am√©lioration  |
| ------------------------------------- | ---------- | ----------- | ------------- |
| Alignement caract√©ristiques-g√©om√©trie | 70-80%     | 100%        | +25%          |
| Convergence entra√Ænement              | Plus lente | Plus rapide | Significative |
| Pr√©cision mod√®le                      | R√©f√©rence  | +2-5%       | Notable       |

**Conclusion** : L'augmentation de 40% du temps en vaut la peine pour une qualit√© de donn√©es d'entra√Ænement significativement meilleure.

---

## üìö Documentation

### Nouvelle Documentation

- ‚úÖ `AUGMENTATION_IMPROVEMENT.md` - Documentation technique compl√®te
- ‚úÖ `AUGMENTATION_QUICK_GUIDE.md` - R√©f√©rence rapide conviviale
- ‚úÖ `AUGMENTATION_IMPLEMENTATION_SUMMARY.md` - D√©tails d'impl√©mentation
- ‚úÖ `RGB_CLOUDCOMPARE_FIX.md` - D√©tails de la correction RGB
- ‚úÖ `RGB_FIX_SUMMARY.md` - R√©sum√© rapide de la correction RGB

### Nouveaux Exemples

- ‚úÖ `examples/demo_augmentation_enrich.py` - D√©monstration en direct
- ‚úÖ `examples/compare_augmentation_approaches.py` - Comparaison visuelle

### Nouveaux Outils

- ‚úÖ `scripts/verify_rgb_enrichment.py` - V√©rifier les valeurs RGB
- ‚úÖ `scripts/fix_rgb_cloudcompare.py` - Corriger les fichiers RGB legacy

---

## üêõ Corrections de Bugs

### Probl√®mes Corrig√©s

1. **Affichage RGB dans CloudCompare** ([#RGB-001](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/issues/RGB-001))

   - Correction de la mise √† l'√©chelle RGB 16-bit incorrecte
   - Les couleurs s'affichent maintenant correctement dans CloudCompare

2. **Incoh√©rence Caract√©ristiques-G√©om√©trie** ([#AUG-001](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/issues/AUG-001))
   - Caract√©ristiques maintenant calcul√©es apr√®s l'augmentation
   - Alignement parfait pour toutes les versions augment√©es

---

## üîÆ Prochaines √âtapes

### Pr√©visions pour v1.7.0 (T1 2026)

- üöÄ **Traitement en Streaming** : G√©rer des datasets de 100M-1B points
- üéØ **Fonctionnalit√©s GPU Avanc√©es** : Support multi-GPU pour le traitement par lots
- üìä **M√©triques de Performance** : Profilage int√©gr√© et optimisation
- üîÑ **Am√©liorations du Pipeline** : Configuration d'√©tapes plus flexible

Voir [Plan GPU Phase 3](GPU_PHASE3_PLAN.md) pour la feuille de route compl√®te.

---

## üí¨ Retour d'Information

Nous aimerions avoir votre retour sur la v1.6.0 !

- üêõ **Signaler des bugs** : [GitHub Issues](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/issues)
- üí° **Demandes de fonctionnalit√©s** : [Discussions](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/discussions)
- üìß **Contact** : <simon.ducournau@gmail.com>

---

## üìÑ Licence

Licence MIT - voir le fichier [LICENSE](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/blob/main/LICENSE) pour les d√©tails.

---

**Derni√®re mise √† jour :** 3 octobre 2025  
**Statut :** ‚úÖ Publi√©  
**Version :** 1.6.0
