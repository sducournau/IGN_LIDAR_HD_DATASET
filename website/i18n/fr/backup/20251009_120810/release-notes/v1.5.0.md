---
sidebar_position: 1
title: Notes de version 1.5.0
---

# Version 1.5.0 - Acc√©l√©ration GPU RGB

**Date de sortie** : 3 octobre 2025  
**Statut** : ‚úÖ Version stable  
**Fonctionnalit√© majeure** : Augmentation RGB acc√©l√©r√©e par GPU

---

## üéâ Nouveaut√©s

La version 1.5.0 introduit l'augmentation RGB acc√©l√©r√©e par GPU, offrant une **am√©lioration des performances de 24x** pour l'ajout de couleurs des orthophotos IGN aux nuages de points LiDAR.

### Points cl√©s

- ‚ö° **24x plus rapide** - Interpolation de couleurs acc√©l√©r√©e par GPU
- üé® **Cache GPU intelligent** - Cache LRU pour les tuiles RGB en m√©moire GPU
- üîÑ **Repli automatique** - Basculement transparent vers CPU si GPU indisponible
- üìä **Pipeline complet** - Acc√©l√©ration GPU de bout en bout pour features + RGB
- üß™ **Enti√®rement test√©** - Suite de tests compl√®te avec benchmarks

---

## üìä Am√©liorations des performances

### Acc√©l√©ration de l'augmentation RGB

```mermaid
graph TD
    A[Taille du nuage de points] --> B{Mode de traitement}

    B -->|CPU| C1[10K pts: 0.12s]
    B -->|CPU| C2[100K pts: 1.2s]
    B -->|CPU| C3[1M pts: 12s]
    B -->|CPU| C4[10M pts: 120s]

    B -->|GPU| D1[10K pts: 0.005s]
    B -->|GPU| D2[100K pts: 0.05s]
    B -->|GPU| D3[1M pts: 0.5s]
    B -->|GPU| D4[10M pts: 5s]

    C1 --> E1[24x]
    D1 --> E1

    C2 --> E2[24x]
    D2 --> E2

    C3 --> E3[24x]
    D3 --> E3

    C4 --> E4[24x]
    D4 --> E4

    style D1 fill:#c8e6c9
    style D2 fill:#c8e6c9
    style D3 fill:#c8e6c9
    style D4 fill:#c8e6c9
    style E1 fill:#fff3e0
    style E2 fill:#fff3e0
    style E3 fill:#fff3e0
    style E4 fill:#fff3e0
```

| Nombre de points | Temps CPU | Temps GPU | Acc√©l√©ration |
| ---------------- | --------- | --------- | ------------ |
| 10 000           | 0.12s     | 0.005s    | **24x**      |
| 100 000          | 1.2s      | 0.05s     | **24x**      |
| 1 000 000        | 12s       | 0.5s      | **24x**      |
| 10 000 000       | 120s      | 5s        | **24x**      |

---

## üöÄ Nouvelles fonctionnalit√©s

### 1. Interpolation de couleurs GPU

Interpolation bilin√©aire rapide sur GPU utilisant CuPy.

```python
from ign_lidar.features_gpu import GPUFeatureComputer
import cupy as cp

# Initialiser le calculateur de features GPU
computer = GPUFeatureComputer(use_gpu=True)

# Points d√©j√† sur GPU
points_gpu = cp.asarray(points)
rgb_image_gpu = cp.asarray(rgb_image)

# Interpoler les couleurs (24x plus rapide)
colors_gpu = computer.interpolate_colors_gpu(
    points_gpu,
    rgb_image_gpu,
    bbox=(xmin, ymin, xmax, ymax)
)
```

**Avantages :**

- Traitement parall√®le de tous les points
- Pas de boucles Python
- Op√©rations vectoris√©es
- Transferts CPU‚ÜîGPU minimaux

### 2. Mise en cache GPU

Cache LRU intelligent pour les tuiles RGB en m√©moire GPU.

```python
from ign_lidar.rgb_augmentation import IGNOrthophotoFetcher

# Activer le mode GPU avec cache
fetcher = IGNOrthophotoFetcher(
    use_gpu=True,
    cache_dir='rgb_cache/'
)

# Premier appel : t√©l√©charge et met en cache
rgb_gpu_1 = fetcher.fetch_orthophoto_gpu(bbox_1)

# Deuxi√®me appel : utilise le cache (instantan√©)
rgb_gpu_2 = fetcher.fetch_orthophoto_gpu(bbox_1)

# G√©rer le cache
fetcher.clear_gpu_cache()  # Vider tout
```

**Caract√©ristiques :**

- Strat√©gie d'√©viction LRU
- Taille de cache configurable (par d√©faut : 10 tuiles)
- ~3MB par tuile (1024√ó1024√ó3 octets)
- Gestion automatique de la m√©moire

### 3. Pipeline GPU de bout en bout

Acc√©l√©ration GPU compl√®te des features au RGB.

```mermaid
sequenceDiagram
    participant CPU as M√©moire CPU
    participant GPU as M√©moire GPU
    participant Compute as Kernels GPU

    CPU->>GPU: Transf√©rer points (une fois)
    GPU->>Compute: Calculer features
    Compute->>GPU: R√©sultats features

    GPU->>Compute: R√©cup√©rer tuile RGB
    Compute->>GPU: RGB en cache

    GPU->>Compute: Interpoler couleurs
    Compute->>GPU: Valeurs RGB

    GPU->>CPU: Transf√©rer r√©sultats (une fois)

    Note over CPU,GPU: Transferts minimaux = Vitesse maximale
```

**Flux de travail :**

1. Charger points ‚Üí GPU
2. Calculer features (GPU)
3. R√©cup√©rer tuile RGB ‚Üí Cache GPU
4. Interpoler couleurs (GPU)
5. Combiner features + RGB (GPU)
6. Transf√©rer vers CPU (une fois)

---

## üîß Am√©liorations de l'API

### Nouvelles m√©thodes

#### `GPUFeatureComputer.interpolate_colors_gpu()`

```python
def interpolate_colors_gpu(
    self,
    points_gpu: cp.ndarray,
    rgb_image_gpu: cp.ndarray,
    bbox: Tuple[float, float, float, float]
) -> cp.ndarray:
    """
    Interpoler les couleurs RGB pour les points avec acc√©l√©ration GPU.

    Args:
        points_gpu: Coordonn√©es des points sur GPU (N, 3)
        rgb_image_gpu: Image RGB sur GPU (H, W, 3)
        bbox: Bo√Æte englobante (xmin, ymin, xmax, ymax)

    Returns:
        Couleurs RGB sur GPU (N, 3)

    Performance:
        ~24x plus rapide que l'interpolation CPU
    """
```

#### `IGNOrthophotoFetcher.fetch_orthophoto_gpu()`

```python
def fetch_orthophoto_gpu(
    self,
    bbox: Tuple[float, float, float, float],
    resolution: float = 0.2
) -> cp.ndarray:
    """
    R√©cup√©rer une tuile RGB sur GPU avec mise en cache.

    Args:
        bbox: Bo√Æte englobante (xmin, ymin, xmax, ymax)
        resolution: R√©solution en m√®tres

    Returns:
        Image RGB sur GPU (H, W, 3)

    Note:
        Utilise un cache LRU en m√©moire GPU
    """
```

---

## üì¶ Installation et mise √† jour

### Mise √† jour depuis v1.4.x

```bash
# Mettre √† jour vers v1.5.0
pip install --upgrade ign-lidar-hd

# Avec support GPU (si pas d√©j√† install√©)
pip install --upgrade ign-lidar-hd[gpu]

# Avec support GPU complet (CuPy + RAPIDS)
pip install --upgrade ign-lidar-hd[gpu-full]
```

### Nouvelle installation

```bash
# Installation standard
pip install ign-lidar-hd

# Avec support GPU
pip install ign-lidar-hd[gpu]

# Avec RAPIDS cuML (meilleures performances)
pip install ign-lidar-hd[gpu-full]
# Ou via conda :
# conda install -c rapidsai -c conda-forge cuml
```

### Pr√©requis GPU

- GPU NVIDIA avec support CUDA
- CUDA Toolkit 11.0+ ou 12.0+
- CuPy correspondant √† votre version CUDA
- Optionnel : RAPIDS cuML pour fonctionnalit√©s avanc√©es

---

## üéØ Exemples d'utilisation

### Augmentation RGB de base avec GPU

```python
from ign_lidar.processor import LiDARProcessor

# Initialiser avec GPU + RGB
processor = LiDARProcessor(
    lod_level="LOD2",
    include_rgb=True,
    rgb_cache_dir='rgb_cache/',
    use_gpu=True  # Active GPU pour features + RGB
)

# Traiter les tuiles (utilise automatiquement le GPU)
processor.process_tile('input.laz', 'output.laz')
```

### Ligne de commande

```bash
# Activer GPU pour features et RGB
ign-lidar-process enrich \
  --input raw_tiles/ \
  --output enriched_tiles/ \
  --add-rgb \
  --rgb-cache-dir rgb_cache/ \
  --use-gpu \
  --num-workers 4
```

### Avanc√© : Utilisation directe de l'API

```python
from ign_lidar.features_gpu import GPUFeatureComputer
from ign_lidar.rgb_augmentation import IGNOrthophotoFetcher
import cupy as cp
import laspy

# Charger le nuage de points
las = laspy.read('tile.laz')
points = cp.asarray(las.xyz)

# Initialiser les composants GPU
computer = GPUFeatureComputer(use_gpu=True)
fetcher = IGNOrthophotoFetcher(use_gpu=True)

# Calculer les features sur GPU
features_gpu = computer.compute_all_features(points, k=20)

# R√©cup√©rer et interpoler RGB sur GPU
bbox = (points[:, 0].min(), points[:, 1].min(),
        points[:, 0].max(), points[:, 1].max())
rgb_image_gpu = fetcher.fetch_orthophoto_gpu(bbox)
colors_gpu = computer.interpolate_colors_gpu(points, rgb_image_gpu, bbox)

# Transf√©rer les r√©sultats vers CPU
features = cp.asnumpy(features_gpu)
colors = cp.asnumpy(colors_gpu)
```

---

## üß™ Tests et validation

### Nouvelle suite de tests

```bash
# Ex√©cuter les tests RGB GPU
pytest tests/test_gpu_rgb.py -v

# Ex√©cuter un test sp√©cifique
pytest tests/test_gpu_rgb.py::test_interpolate_colors_gpu -v

# Ex√©cuter les benchmarks
python scripts/benchmarks/benchmark_rgb_gpu.py
```

### Couverture des tests

- ‚úÖ Pr√©cision de l'interpolation de couleurs GPU
- ‚úÖ Benchmarks de performance GPU
- ‚úÖ Fonctionnalit√© du cache GPU
- ‚úÖ Repli automatique vers CPU
- ‚úÖ Gestion des erreurs
- ‚úÖ Tests d'int√©gration
- ‚úÖ Pipeline de bout en bout

---

## üìö Mises √† jour de la documentation

### Nouvelle documentation

- **[Guide GPU RGB](../rgb-gpu-guide.md)** - Guide d'utilisation complet
- **[Vue d'ensemble de l'architecture](../architecture.md)** - Mise √† jour avec flux GPU RGB
- **[Benchmarks de performance](../guides/performance.md)** - M√©triques GPU RGB
- **Notes de version** - Ce document

### Documentation mise √† jour

- **[Guide GPU](../gpu-guide.md)** - Section GPU RGB ajout√©e
- **[Guide d'installation](../installation/gpu.md)** - Pr√©requis mis √† jour
- **[R√©f√©rence API](../api/rgb-augmentation.md)** - Nouvelles m√©thodes GPU
- **[D√©pannage](../guides/troubleshooting.md)** - Probl√®mes GPU RGB

---

## üîÑ Guide de migration

### De v1.4.x √† v1.5.0

**Aucun changement incompatible !** La version 1.5.0 est enti√®rement r√©trocompatible.

#### Le code existant fonctionne sans modification

```python
# Le code v1.4.x fonctionne en v1.5.0
processor = LiDARProcessor(
    include_rgb=True,
    use_gpu=True  # Acc√©l√®re maintenant aussi le RGB !
)
```

#### Les nouvelles fonctionnalit√©s sont optionnelles

```python
# Utiliser explicitement le GPU RGB (optionnel)
from ign_lidar.rgb_augmentation import IGNOrthophotoFetcher

fetcher = IGNOrthophotoFetcher(use_gpu=True)  # Nouveau param√®tre
```

---

## üêõ Corrections de bugs

- Correction de fuite m√©moire dans l'√©viction du cache GPU
- Am√©lioration des messages d'erreur pour les erreurs CUDA
- Correction des cas limites de transformation de coordonn√©es
- Meilleure gestion des points hors limites
- Am√©lioration de la s√©curit√© des threads pour les op√©rations GPU

---

## üîó Ressources connexes

### Documentation

- üìò [Guide GPU RGB](../rgb-gpu-guide.md)
- üèóÔ∏è [Vue d'ensemble de l'architecture](../architecture.md)
- ‚ö° [Guide GPU](../gpu-guide.md)
- üîß [R√©f√©rence API](../api/)

### D√©tails d'impl√©mentation

- `ign_lidar/features_gpu.py` - Calculateur de features GPU
- `ign_lidar/rgb_augmentation.py` - R√©cup√©rateur RGB avec GPU
- `tests/test_gpu_rgb.py` - Suite de tests
- `scripts/benchmarks/benchmark_rgb_gpu.py` - Benchmarks

---

## üí¨ Retours et support

Nous aimerions conna√Ætre votre exp√©rience avec la v1.5.0 !

- üêõ **Signaler un bug** : [GitHub Issues](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/issues)
- üí° **Demandes de fonctionnalit√©s** : [GitHub Discussions](https://github.com/sducournau/IGN_LIDAR_HD_DATASET/discussions)
- üìß **Email** : simon.ducournau@gmail.com

---

## üéØ Prochaines √©tapes

### v1.6.0 (Pr√©vu)

- Support multi-GPU pour traitement √† grande √©chelle
- Pr√©-chargement asynchrone des tuiles RGB
- Gestion am√©lior√©e de la m√©moire
- Fonctionnalit√©s suppl√©mentaires acc√©l√©r√©es par GPU

### Retours de la communaut√©

Nous sommes particuli√®rement int√©ress√©s par :

- R√©sultats de performance en conditions r√©elles
- Rapports de compatibilit√© mat√©rielle GPU
- Demandes de fonctionnalit√©s pour futures versions
- Cas d'usage et flux de travail

---

**Merci d'utiliser IGN LiDAR HD Processing Library !** üôè

---

**Informations de version**

- **Version** : 1.5.0
- **Date de sortie** : 3 octobre 2025
- **Licence** : MIT
- **Python** : 3.8+
- **CUDA** : 11.0+ ou 12.0+ (optionnel)
